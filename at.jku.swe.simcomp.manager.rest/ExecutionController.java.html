<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExecutionController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Adaptor Manager</a> &gt; <a href="index.source.html" class="el_package">at.jku.swe.simcomp.manager.rest</a> &gt; <span class="el_source">ExecutionController.java</span></div><h1>ExecutionController.java</h1><pre class="source lang-java linenums">package at.jku.swe.simcomp.manager.rest;

import at.jku.swe.simcomp.commons.HttpErrorDTO;
import at.jku.swe.simcomp.commons.adaptor.endpoint.exception.BadRequestException;
import at.jku.swe.simcomp.commons.adaptor.endpoint.simulation.SimulationInstanceConfig;
import at.jku.swe.simcomp.commons.adaptor.execution.command.ExecutionCommand;
import at.jku.swe.simcomp.commons.manager.dto.execution.ExecutionDTO;
import at.jku.swe.simcomp.manager.service.ExecutionService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.media.ArraySchema;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.UUID;

@RestController
@RequestMapping(&quot;/session&quot;)
<span class="fc" id="L26">@Slf4j</span>
@Tag(description = &quot;Endpoints to execute commands on simulation instances associated with a session.&quot;, name = &quot;Execution Controller&quot;)
public class ExecutionController {
    private final ExecutionService executionService;

<span class="fc" id="L31">    public ExecutionController(ExecutionService executionService) {</span>
<span class="fc" id="L32">        this.executionService = executionService;</span>
<span class="fc" id="L33">    }</span>

    @Operation(summary = &quot;Execute Command&quot;,
            description = &quot;Asynchronously executes the command against all simulation instances associated with the session.&quot; +
                    &quot;If a command is not supported by one of the simulation types associated with the session, the command is not distributed to the corresponding instance.&quot; +
                    &quot;Returns the ID of the request as UUID.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;202&quot;,
                    description = &quot;Commands distributed.&quot;,
                    content = @io.swagger.v3.oas.annotations.media.Content(
                            schema = @Schema(implementation = UUID.class),
                            examples = @ExampleObject(value = &quot;123e4567-e89b-12d3-a456-426614174001&quot;)
                    )
            ),
            @ApiResponse(responseCode = &quot;404&quot;,
                    description = &quot;Session not found&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = HttpErrorDTO.class),
                            examples =@ExampleObject(value = &quot;{\&quot;type\&quot;:\&quot;ERROR\&quot;,\&quot;status\&quot;:404, \&quot;message\&quot;:\&quot;Session not found.\&quot;}&quot;)
                    )),
            @ApiResponse(responseCode = &quot;500&quot;,
                    description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = HttpErrorDTO.class),
                            examples =@ExampleObject(value = &quot;{\&quot;type\&quot;:\&quot;ERROR\&quot;,\&quot;status\&quot;:500, \&quot;message\&quot;:\&quot;Internal server error.\&quot;}&quot;)
                    ))
    })
    @io.swagger.v3.oas.annotations.parameters.RequestBody(description = &quot;The command to be executed&quot;,
            content = @io.swagger.v3.oas.annotations.media.Content(
                    schema = @Schema(implementation = ExecutionCommand.class),
                    examples = {
                            @ExampleObject(name = &quot;Composite Command&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;COMPOSITE\&quot;, \&quot;commands\&quot;:[{\&quot;type\&quot;: \&quot;SET_JOINT_POSITION\&quot;, \&quot;jointPosition\&quot;: {\&quot;joint\&quot;:\&quot;AXIS_1\&quot;, \&quot;radians\&quot;:1.0}},{\&quot;type\&quot;: \&quot;GRAB\&quot;}]}&quot;),
                            @ExampleObject(name = &quot;Adjust Joint Angle&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;ADJUST_JOINT_ANGLE\&quot;, \&quot;jointAngleAdjustment\&quot;: {\&quot;joint\&quot;:\&quot;AXIS_1\&quot;, \&quot;byRadians\&quot;:1.0}}&quot;),
                            @ExampleObject(name = &quot;Set Joint Position&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;SET_JOINT_POSITION\&quot;, \&quot;jointPosition\&quot;: {\&quot;joint\&quot;:\&quot;AXIS_1\&quot;, \&quot;radians\&quot;:1.0}}&quot;),
                            @ExampleObject(name = &quot;Pose Command&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;POSE\&quot;, \&quot;position\&quot;: {\&quot;x\&quot;: 0.0, \&quot;y\&quot;:0.0, \&quot;z\&quot;:1.0}, \&quot;orientation\&quot;: {\&quot;x\&quot;: 0.0, \&quot;y\&quot;:0.0, \&quot;z\&quot;:1.0, \&quot;w\&quot;:0.0}}&quot;),
                            @ExampleObject(name = &quot;Set Position&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;SET_POSITION\&quot;, \&quot;position\&quot;: {\&quot;x\&quot;: 0.0, \&quot;y\&quot;:0.0, \&quot;z\&quot;:1.0}}&quot;),
                            @ExampleObject(name = &quot;Reset to Home&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;RESET_TO_HOME\&quot;}&quot;),
                            @ExampleObject(name = &quot;Grab&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;GRAB\&quot;}&quot;),
                            @ExampleObject(name = &quot;Toggle Gripper Mode&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;TOGGLE_GRIPPER_MODE\&quot;}&quot;),
                            @ExampleObject(name = &quot;Stop&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;STOP\&quot;}&quot;),
                            @ExampleObject(name = &quot;Pause&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;PAUSE\&quot;}&quot;),
                            @ExampleObject(name = &quot;Resume&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;RESUME\&quot;}&quot;),
                            @ExampleObject(name = &quot;Calibrate&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;CALIBRATE\&quot;}&quot;),
                            @ExampleObject(name = &quot;Open Hand&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;OPEN_HAND\&quot;}&quot;),
                            @ExampleObject(name = &quot;Set Speed&quot;, value = &quot;{ \&quot;type\&quot;: \&quot;SET_SPEED\&quot;, \&quot;speed\&quot;:2.3}&quot;),
                    }))
    @PostMapping(value = &quot;/{sessionId}/execution&quot;, consumes = &quot;application/json&quot;, produces = &quot;text/html&quot;)
    public ResponseEntity&lt;String&gt; execute(@Parameter(description = &quot;The id of the session.&quot;, required = true, schema = @Schema(implementation = UUID.class, example = &quot;123e4567-e89b-12d3-a456-426614174001&quot;))
                                              @PathVariable(&quot;sessionId&quot;) UUID sessionId,
                                  @RequestBody ExecutionCommand command) throws BadRequestException {
<span class="nc" id="L83">        log.info(&quot;Request to execute command for session {}: {}&quot;, sessionId, command);</span>
<span class="nc" id="L84">        UUID executionId = executionService.executeCommand(sessionId, command);</span>
<span class="nc" id="L85">        log.info(&quot;Returning execution id {}&quot;, executionId);</span>
<span class="nc" id="L86">        return ResponseEntity.status(202).body(executionId.toString());</span>
    }

    @Operation(summary = &quot;Get information about execution and responses.&quot;,
            description = &quot;Returns information about the execution and the current state of the responses from the simulation instances.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;,
                    description = &quot;Success.&quot;,
                    content = @io.swagger.v3.oas.annotations.media.Content(
                            schema = @Schema(implementation = ExecutionDTO.class),
                            examples =
                            @ExampleObject(name = &quot;executionDTOExample&quot;, value =
                            &quot;{ \&quot;id\&quot;: \&quot;123e4567-e89b-12d3-a456-426614174001\&quot;, \&quot;sessionId\&quot;: \&quot;f47ac10b-58cc-4372-a567-0e02b2c3d479\&quot;, \&quot;command\&quot;: {\&quot;type\&quot;:\&quot;GRAB\&quot;}, \&quot;createdAt\&quot;: \&quot;2023-01-01T12:34:56\&quot;, &quot; +
                                    &quot;\&quot;responses\&quot;: [&quot; +
                                    &quot;  { \&quot;simulationName\&quot;: \&quot;WEBOTS\&quot;, \&quot;responseCode\&quot;: 200, \&quot;state\&quot;:\&quot;SUCCESS\&quot;, \&quot;report\&quot;:\&quot;Grab command was executed.\&quot; }, &quot; +
                                    &quot;  { \&quot;simulationName\&quot;: \&quot;GAZEBO\&quot;, \&quot;responseCode\&quot;: 202, \&quot;state\&quot;:\&quot;RUNNING\&quot;, \&quot;report\&quot;:\&quot;\&quot; }, &quot; +
                                    &quot;  { \&quot;simulationName\&quot;: \&quot;PHYSICAL\&quot;, \&quot;responseCode\&quot;: 401, \&quot;state\&quot;:\&quot;ERROR\&quot;, \&quot;report\&quot;:\&quot;Session is not valid anymore.\&quot; } &quot; +
                                    &quot;] }&quot;
                    ))
            ),
            @ApiResponse(responseCode = &quot;404&quot;,
                    description = &quot;Session not found&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = HttpErrorDTO.class),
                            examples =@ExampleObject(value = &quot;{\&quot;type\&quot;:\&quot;ERROR\&quot;,\&quot;status\&quot;:404, \&quot;message\&quot;:\&quot;Session not found.\&quot;}&quot;)
                    )),
            @ApiResponse(responseCode = &quot;500&quot;,
                    description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = HttpErrorDTO.class),
                            examples =@ExampleObject(value = &quot;{\&quot;type\&quot;:\&quot;ERROR\&quot;,\&quot;status\&quot;:500, \&quot;message\&quot;:\&quot;Internal server error.\&quot;}&quot;)
                    ))
    })
    @GetMapping(value = &quot;/execution/{executionId}&quot;, produces = &quot;application/json&quot;)
    public ResponseEntity&lt;ExecutionDTO&gt; getExecutionDetails(@Parameter(description = &quot;The id of the execution&quot;, schema = @Schema(implementation = UUID.class))
                                                                @PathVariable UUID executionId){
<span class="nc" id="L122">        log.info(&quot;Request to fetch execution {}.&quot;, executionId);</span>
<span class="nc" id="L123">        ExecutionDTO dto = executionService.getExecution(executionId);</span>
<span class="nc" id="L124">        return ResponseEntity.ok(dto);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>